<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pedido - Hamburgueria Texas</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #fff;
    }

    .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 10px;
        font-size: 14px;
        color: #000;
    }

    .product-image {
        position: relative;
        width: 100%;
        height: 250px;
        background-color: #eee;
        overflow: hidden;
    }

    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .back-button {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(255,255,255,0.8);
        border-radius: 50%;
        padding: 5px;
        font-size: 18px;
        cursor: pointer;
        user-select: none;
    }

    .content {
        padding: 15px;
        padding-bottom: 120px; /* espa√ßo maior para evitar que o conte√∫do fique atr√°s do footer */
    }

    .title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .price {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .description {
        font-size: 14px;
        color: #555;
        margin-bottom: 10px;
    }

    .cashback {
        display: inline-block;
        background-color: #444;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 13px;
        margin-bottom: 15px;
    }

    /* bot√£o centralizado abaixo do cashback */
    .btn-add-more {
        display: block;
        margin: 10px auto 18px auto;
        padding: 10px 18px;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        border: none;
    }

    .search-box {
        width: 100%;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 20px;
    }

    .extras-title {
        font-weight: bold;
        margin-bottom: 10px;
    }

    .extra-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }

    .extra-name {
        font-size: 14px;
    }

    .extra-price {
        font-size: 14px;
        color: #000;
        margin-left:8px;
    }

    /* Controles de quantidade */
    .extra-controls {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .qty-button {
        background-color: #f2f2f2;
        border: none;
        font-size: 18px;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    .extra-qty {
        min-width: 20px;
        text-align: center;
        font-size: 14px;
        font-weight: bold;
    }

    /* Extras selecionados */
    .selected-extras {
        margin-top: 15px;
        border-top: 1px solid #ccc;
        padding-top: 10px;

        max-height: 200px;   /* limita a altura para n√£o crescer demais */
        overflow-y: auto;    /* adiciona rolagem se ultrapassar a altura */
    }

    .selected-extras h4 {
        margin: 0 0 10px 0;
    }

    .selected-extra-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
        font-size: 14px;
    }

    .remove-button {
        background-color: #d9534f;
        border: none;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        font-weight: bold;
        cursor: pointer;
        line-height: 20px;
        text-align: center;
        padding: 0;
    }

    .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #222;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        font-size: 16px;
        z-index: 1000; /* garante que o footer fique acima de outros elementos */
        box-sizing: border-box; /* para padding n√£o ultrapassar a largura */
    }

    .footer button {
        background-color: transparent;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        flex-shrink: 0; /* bot√£o n√£o encolhe */
    }

    #footer-preco {
        max-width: 50%; /* limita largura para evitar overflow */
        white-space: nowrap; /* impede quebra de linha */
        overflow: hidden;
        text-overflow: ellipsis; /* mostra "..." se texto for grande */
        text-align: right;
    }

    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 999;
    }

    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        max-width: 300px;
        width: 90%;
    }

    .modal-content img {
        width: 50px;
        margin-bottom: 15px;
    }

    .modal-content h2 {
        font-size: 20px;
        margin-bottom: 20px;
    }

    .btn-green {
        background-color: green;
        color: white;
        border: none;
        padding: 10px 15px;
        font-size: 14px;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
    }

    .btn-red {
        background-color: red;
        color: white;
        border: none;
        padding: 10px 15px;
        font-size: 14px;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
    }

    /* --- Novos estilos do carrinho --- */
    .cart-container {
        margin-top: 18px;
        border-top: 1px solid #ddd;
        padding-top: 12px;
        margin-bottom: 20px;
    }

    .cart-title {
        font-weight: bold;
        margin-bottom: 10px;
    }

    .cart-item {
        padding: 10px;
        border: 1px solid #eee;
        border-radius: 8px;
        margin-bottom: 10px;
        background: #fafafa;
    }

    .cart-item h4 {
        margin: 0 0 6px 0;
        font-size: 15px;
    }

    .cart-item .cart-extras {
        font-size: 13px;
        color: #333;
        margin-bottom: 8px;
    }

    .cart-item .cart-controls {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .cart-item .cart-qty {
        min-width: 28px;
        text-align: center;
        font-weight: bold;
    }

    .cart-item .cart-total {
        margin-left: auto;
        font-weight: bold;
    }

    .product-qty {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
    }

    @media (max-width:420px){
        .price { font-size: 16px; }
        .title { font-size: 16px; }
        .product-image { height: 200px; }
    }

</style>
</head>
<body>

<div class="product-image">
    <img id="produto-img" src="sua-imagem.jpg" alt="Combo Texas" />
    <div class="back-button" id="btnVoltar">‚Üê</div>
</div>

<div class="content">
    <div class="title" id="produto-nome"></div>
    <div class="price" id="produto-preco"></div>

    <!-- controle de quantidade do produto atual (adicionado sem alterar a estrutura geral) -->
    <div class="product-qty" id="product-qty" aria-label="Quantidade do produto">
        <button class="qty-button" id="produto-minus">‚àí</button>
        <div id="produto-quantidade" class="cart-qty">1</div>
        <button class="qty-button" id="produto-plus">+</button>
        <div style="margin-left:8px; font-size:14px; color:#555;" id="item-subtotal-label">Subtotal do item: <strong id="item-subtotal">R$ 0,00</strong></div>
    </div>

    <div class="description" id="produto-descricao"></div>
    <div class="cashback">üí≥ Ganhe 5% de cashback</div>

    <!-- container onde a sacola (itens salvos) ser√° exibida, um item abaixo do outro -->
    <div class="cart-container" id="cart-container" style="display:none;">
        <div class="cart-title">Sacola / Itens adicionados</div>
        <div id="cart-list"></div>
    </div>
    <!-- bot√£o solicitado: centralizado abaixo da mensagem de cashback -->
    <button id="btnAdicionarMais" class="btn-add-more btn-green" type="button">Adicionar mais itens</button>

    <input type="text" class="search-box" placeholder="Pesquise pelo nome" />

    <div class="extras-title">Adicionais</div>

    <div id="extras-list">
        <div class="extra-item" data-extra-id="bacon">
            <span class="extra-name">Adicionar Bacon</span>
            <span class="extra-controls">
                <button class="qty-button" data-action="minus">‚àí</button>
                <span class="extra-qty">0</span>
                <button class="qty-button" data-action="plus">+</button>
                <span class="extra-price">R$ 5,90</span>
            </span>
        </div>
        <div class="extra-item" data-extra-id="cheddar">
            <span class="extra-name">Adicionar Cheddar</span>
            <span class="extra-controls">
                <button class="qty-button" data-action="minus">‚àí</button>
                <span class="extra-qty">0</span>
                <button class="qty-button" data-action="plus">+</button>
                <span class="extra-price">R$ 3,90</span>
            </span>
        </div>
    </div>

    <div class="selected-extras" id="selected-extras" style="display:none;">
      <h4>Adicionais selecionados:</h4>
      <div id="selected-extras-list"></div>
    </div>


<div class="footer">
    <button id="btnAvancar">Avan√ßar</button>
    <span id="footer-preco">R$ 0,00</span>
</div>

<!-- Modal -->
<div class="modal" id="modalEntrega">
    <div class="modal-content">
        <img src="https://cdn-icons-png.flaticon.com/512/189/189665.png" alt="√çcone" />
        <h2>Deseja que entregamos agora?</h2>
        <button class="btn-green">Sim, por favor!</button>
        <button class="btn-red">N√£o, quero agendar a entrega!</button>
    </div>
</div>

<script>
const produtos = {
    "combo-texas": { nome: "Combo Texas Hamburguinho (smash) + batata p + refri p", preco: "R$ 34,90", descricao: "P√£o brioche, hamb√∫rguer 70gr, cheddar, bacon, alface, tomate, molho american, batata p e refri p", imagem: "combo-texas.jpg", alt: "Imagem do Combo Texas" },
    "texas-cheddar": { nome: "Texas Cheddar", preco: "R$ 19,90", descricao: "P√£o australiano, hamb√∫rguer 150g, cebola crispy, cheddar e molho", imagem: "2.png", alt: "Imagem do Texas Cheddar" },
    "duplo-bacon": { nome: "Duplo Bacon", preco: "R$ 24,90", descricao: "P√£o brioche, dois hamb√∫rgueres 150g, bacon, queijo prato e molho especial", imagem: "3.png", alt: "Imagem do Duplo Bacon" },
    "veggie-burger": { nome: "Veggie Burger", preco: "R$ 21,90", descricao: "P√£o integral, hamb√∫rguer de gr√£o-de-bico, alface, tomate e maionese vegana", imagem: "4.png", alt: "Imagem do Veggie Burger" },
    "brisket-burger": { nome: "Brisket Burger", preco: "R$ 27,90", descricao: "P√£o brioche, brisket defumado, queijo cheddar, picles e molho barbecue", imagem: "5.png", alt: "Imagem do Brisket Burger" },
    "smash-classic": { nome: "Smash Classic", preco: "R$ 18,90", descricao: "P√£o brioche, hamb√∫rguer smash 100g, queijo prato e maionese da casa", imagem: "smash-classic-placeholder.png", alt: "Imagem do Smash Classic" },
    "chicken-crispy": { nome: "Chicken Crispy", preco: "R$ 20,90", descricao: "P√£o brioche, frango empanado crocante, alface, tomate e maionese", imagem: "chicken-crispy-placeholder.png", alt: "Imagem do Chicken Crispy" },
    "combo-classic": { nome: "Combo Classic", preco: "R$ 29,90", descricao: "Hamb√∫rguer cl√°ssico + batata frita + refrigerante lata", imagem: "combo-classic-placeholder.png", alt: "Imagem do Combo Classic" }
};

const adicionais = {
    "bacon": { nome: "Bacon", preco: 5.90 },
    "cheddar": { nome: "Cheddar", preco: 3.90 }
};

const STORAGE_KEY = 'sacola';
let cart = [];
let selecionados = {};
let basePreco = 0;
let currentQuantity = 1;

function getQueryParam(param) {
    return new URLSearchParams(window.location.search).get(param);
}

function parsePreco(precoStr) {
    if (!precoStr) return 0;
    return parseFloat(precoStr.replace("R$","").replace(/\./g,"").replace(",",".") || 0);
}

function formatBRL(value) {
    return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

/* ---------- Local Storage ---------- */
function loadCartFromStorage() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
    catch(e) { console.error(e); return []; }
}
function saveCartToStorage(arr) {
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
    catch(e) { console.error(e); }
}

/* ---------- Produto atual ---------- */
function atualizarProduto() {
    const lancheId = getQueryParam('lanche');
    const produto = produtos[lancheId];
    const nomeElem = document.getElementById('produto-nome');
    const precoElem = document.getElementById('produto-preco');
    const descElem = document.getElementById('produto-descricao');
    const imgElem = document.getElementById('produto-img');

    if (produto) {
        nomeElem.textContent = produto.nome;
        precoElem.textContent = produto.preco;
        descElem.textContent = produto.descricao;
        imgElem.src = produto.imagem;
        imgElem.alt = produto.alt;
        basePreco = parsePreco(produto.preco);
    } else {
        nomeElem.textContent = "Produto n√£o encontrado";
        precoElem.textContent = "";
        descElem.textContent = "Escolha um lanche v√°lido.";
        imgElem.src = "imagem-nao-encontrada.jpg";
        imgElem.alt = "Produto n√£o encontrado";
        basePreco = 0;
    }

    currentQuantity = 1;
    document.getElementById('produto-quantidade').textContent = currentQuantity;
    selecionados = {};
    document.querySelectorAll('#extras-list .extra-qty').forEach(el => el.textContent = '0');
    atualizarExtrasSelecionados();
    atualizarItemSubtotal();
}

/* ---------- Extras ---------- */
function atualizarExtrasSelecionados() {
    const container = document.getElementById('selected-extras');
    const lista = document.getElementById('selected-extras-list');
    lista.innerHTML = "";
    const keys = Object.keys(selecionados);
    if (keys.length === 0) { container.style.display='none'; return; }
    container.style.display='block';

    keys.forEach(id => {
        const count = selecionados[id];
        if (count > 0) {
            const div = document.createElement('div');
            div.className = 'selected-extra-item';
            div.innerHTML = `<span>${adicionais[id].nome} x${count} (${formatBRL(adicionais[id].preco*count)})</span>
                             <button class="remove-button" data-id="${id}">‚àí</button>`;
            lista.appendChild(div);
        }
    });

    lista.querySelectorAll('button.remove-button').forEach(btn => {
        btn.onclick = () => {
            const id = btn.dataset.id;
            if (selecionados[id]) { selecionados[id]--; if (selecionados[id]<=0) delete selecionados[id]; }
            const el = document.querySelector(`.extra-item[data-extra-id="${id}"] .extra-qty`);
            if (el) el.textContent = selecionados[id] || 0;
            atualizarExtrasSelecionados();
            atualizarItemSubtotal();
            atualizarCartTotal();
        };
    });
}

/* ---------- Subtotal ---------- */
function calcularSubtotalItemAtual() {
    let somaExtras = 0;
    for(const id in selecionados) somaExtras += (adicionais[id].preco * selecionados[id]);
    return (basePreco + somaExtras) * currentQuantity;
}
function atualizarItemSubtotal() {
    document.getElementById('item-subtotal').textContent = formatBRL(calcularSubtotalItemAtual());
}

/* ---------- Carrinho ---------- */
function extrasSignature(extrasArray) {
    if (!extrasArray || extrasArray.length===0) return "";
    return extrasArray.map(e=>`${e.id}:${e.quantidade}`).sort().join('|');
}

function addToCart(item) {
    const currentCart = loadCartFromStorage();
    const signature = extrasSignature(item.extras);
    const idx = currentCart.findIndex(ci => ci.id===item.id && extrasSignature(ci.extras)===signature);
    if (idx!==-1) currentCart[idx].quantidade += item.quantidade || 0;
    else currentCart.push(item);
    saveCartToStorage(currentCart);
    cart = currentCart;
}

function calcularTotalCarrinho() {
    let total=0;
    for(const it of cart){
        let somaExtras=0;
        if(it.extras) it.extras.forEach(e=>somaExtras+=(e.preco*e.quantidade));
        total+=(it.preco+somaExtras)*(it.quantidade||0);
    }
    return total;
}

function atualizarCartTotal() {
    const cartTotal = calcularTotalCarrinho();
    const lancheId = getQueryParam('lanche');
    const itemNoCarrinho = cart.some(item => item.id===lancheId && (!item.extras || item.extras.length===0));
    const totalGeral = itemNoCarrinho ? cartTotal : cartTotal + calcularSubtotalItemAtual();
    document.getElementById('footer-preco').textContent = formatBRL(totalGeral);
    localStorage.setItem('pedidoValor', totalGeral);
}

function renderCart() {
    const container = document.getElementById('cart-container');
    const list = document.getElementById('cart-list');
    list.innerHTML = '';
    cart = loadCartFromStorage();
    if(!cart || cart.length===0){ container.style.display='none'; atualizarCartTotal(); return; }
    container.style.display='block';

    cart.forEach((it, idx)=>{
        let extrasText='';
        if(it.extras && it.extras.length>0) extrasText=it.extras.map(e=>`${e.nome} x${e.quantidade}`).join(', ');
        let somaExtras=0;
        if(it.extras) it.extras.forEach(e=>somaExtras+=(e.preco*e.quantidade));
        const totalItem=(it.preco+somaExtras)*(it.quantidade||0);

        const div=document.createElement('div');
        div.className='cart-item';
        div.innerHTML = `
            <h4>${it.nome}</h4>
            <div class="cart-extras">${extrasText || ''}</div>
            <div style="display:flex; align-items:center;">
                <div class="cart-controls">
                    <button class="qty-button cart-minus" data-idx="${idx}">‚àí</button>
                    <div class="cart-qty" id="cart-qty-${idx}">${it.quantidade}</div>
                    <button class="qty-button cart-plus" data-idx="${idx}">+</button>
                    <button class="remove-button" style="margin-left:8px;" data-idx="${idx}">√ó</button>
                </div>
                <div class="cart-total" id="cart-total-${idx}">${formatBRL(totalItem)}</div>
            </div>
        `;
        list.appendChild(div);
    });

    list.querySelectorAll('.cart-plus').forEach(btn=>btn.onclick=()=>{const idx=+btn.dataset.idx; cart[idx].quantidade++; saveCartToStorage(cart); renderCart(); atualizarCartTotal();});
    list.querySelectorAll('.cart-minus').forEach(btn=>btn.onclick=()=>{const idx=+btn.dataset.idx; cart[idx].quantidade--; if(cart[idx].quantidade<=0) cart.splice(idx,1); saveCartToStorage(cart); renderCart(); atualizarCartTotal();});
    list.querySelectorAll('.remove-button').forEach(btn=>btn.onclick=()=>{const idx=+btn.dataset.idx; cart.splice(idx,1); saveCartToStorage(cart); renderCart(); atualizarCartTotal();});

    atualizarCartTotal();
}

/* ---------- Inicializa√ß√£o ---------- */
window.onload = ()=>{
    atualizarProduto();
    cart = loadCartFromStorage();
    renderCart();
    atualizarCartTotal();

    document.getElementById('btnVoltar').onclick = ()=> window.history.length>1 ? window.history.back() : location.href='index.html';

    document.getElementById('produto-plus').onclick = ()=>{
        currentQuantity++; document.getElementById('produto-quantidade').textContent=currentQuantity;
        atualizarItemSubtotal(); atualizarCartTotal();
    };
    document.getElementById('produto-minus').onclick = ()=>{
        if(currentQuantity>1) currentQuantity--; document.getElementById('produto-quantidade').textContent=currentQuantity;
        atualizarItemSubtotal(); atualizarCartTotal();
    };

    document.querySelectorAll('#extras-list .qty-button').forEach(btn=>{
        btn.onclick = ()=>{
            const extraItem = btn.closest('.extra-item');
            const extraId = extraItem.dataset.extraId;
            const action = btn.dataset.action;
            if(!selecionados[extraId]) selecionados[extraId]=0;
            if(action==='plus') selecionados[extraId]++;
            else if(action==='minus') selecionados[extraId]--;
            if(selecionados[extraId]<=0) delete selecionados[extraId];
            extraItem.querySelector('.extra-qty').textContent=selecionados[extraId]||0;
            atualizarExtrasSelecionados(); atualizarItemSubtotal(); atualizarCartTotal();
        };
    });

    document.getElementById('btnAdicionarMais').onclick = ()=>{
        const lancheId=getQueryParam('lanche');
        if(!lancheId || !produtos[lancheId]) return alert('Produto inv√°lido.');

        const item = {
            id: lancheId,
            nome: produtos[lancheId].nome,
            preco: parsePreco(produtos[lancheId].preco),
            quantidade: currentQuantity,
            extras: [],
            imagem: produtos[lancheId].imagem, // ‚úÖ SALVA IMAGEM
            alt: produtos[lancheId].alt // opcional
        };

        for(const extraId in selecionados) if(selecionados[extraId]>0) item.extras.push({ id: extraId, nome: adicionais[extraId].nome, preco: adicionais[extraId].preco, quantidade: selecionados[extraId] });

        addToCart(item);
        window.location.href='index.html';
    };

    const btnAvancar=document.getElementById('btnAvancar');
    const modal=document.getElementById('modalEntrega');

    btnAvancar.onclick=()=> modal.style.display='flex';
    document.querySelectorAll('#modalEntrega button').forEach(btn=>btn.onclick=()=>modal.style.display='none');

    const btnSim=document.querySelector('#modalEntrega .btn-green');
    if(btnSim) btnSim.onclick=()=>{
        modal.style.display='none';
        const lancheId=getQueryParam('lanche');
        if(lancheId && produtos[lancheId]){
            const item = {
                id: lancheId,
                nome: produtos[lancheId].nome,
                preco: parsePreco(produtos[lancheId].preco),
                quantidade: currentQuantity,
                extras: [],
                imagem: produtos[lancheId].imagem,
                alt: produtos[lancheId].alt
            };
            for(const extraId in selecionados) if(selecionados[extraId]>0) item.extras.push({ id: extraId, nome: adicionais[extraId].nome, preco: adicionais[extraId].preco, quantidade: selecionados[extraId] });
            addToCart(item);
        }
        const currentCart = loadCartFromStorage();
        localStorage.setItem('pedidoItens', JSON.stringify(currentCart));
        atualizarCartTotal();
        window.location.href='cadastro.html';
    };

    const btnNao=document.querySelector('#modalEntrega .btn-red');
    if(btnNao) btnNao.onclick=()=>modal.style.display='none';

    atualizarItemSubtotal();
    atualizarCartTotal();
};
</script>

</body>
</html>
